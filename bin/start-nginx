#!/usr/bin/env bash

#Evaluate config to get $PORT
erb /app/nginx.conf.erb > /app/nginx/nginx.conf

#Start log redirection.
(
    #Initialize log directory.
    touch /app/logs/nginx/access.log /app/logs/nginx/error.log
    #Redirect NGINX logs to stdout.
    echo 'buildpack=nginx at=logs-initialized'
    tail -qF -n 0 /app/logs/nginx/*.log
) &

#Start NGINX
(
    #We expect nginx to run in foreground.
    echo 'buildpack=nginx at=nginx-start'
    /app/nginx/nginx -c /app/nginx/nginx.conf
)

echo "buildpack=nginx at=exit process=$exit_process"
exit 1
